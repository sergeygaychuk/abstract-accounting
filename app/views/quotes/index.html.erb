<% content_for :head do %>
  <title>Abstract::Quotes</title>
<% end %>

<script type="text/javascript">
var canSelect = true;
$(function() {
  $('#quote_datepicker').datepicker();
});
function enabledElements() {
  $('#quote_res_btn').removeAttr('disabled');
  $('#quote_datepicker').removeAttr('disabled');
  $('#quote_rate').removeAttr('disabled');
  setDefault();
}
function chooseMoney()
{
  $('#quotes_div').css('display','none');
  $('#frame_quote_div').css('display','block');
  $('#frame').attr('src', 'resources');
  $('#title_frame').html('Resources');

  $('#submit').click(function() {
    var selRow = $('#frame').contents().find('#resources_list')
                                       .getGridParam('selrow');
    if (selRow != null)
    {
      $('#quote_res_btn').val($('#frame').contents().find('#resources_list')
                                            .getCell(selRow, 'tag'));
      $('#hide_quote_money').val($('#frame').contents().find('#resources_list')
                                            .getCell(selRow, 'id'));
      $('#quotes_div').css('display','block');
      $('#frame_quote_div').css('display','none');
      $('#frame').attr('src', '');
      $("#submit").unbind("click");
      $('#save_quote').removeAttr('disabled');
    }
  });
}
function discardChoose()
{
  $('#quotes_div').css('display','block');
  $('#frame_quote_div').css('display','none');
}
function beforeSave()
{
  var d = new Date($('#quote_datepicker').val());
  $('#hide_quote_day').val(d.toUTCString());
  $('#hide_quote_rate').val($('#quote_rate').val());
}
function disabledElements() {
  $('#quote_res_btn').attr('disabled','disabled');
  $('#quote_datepicker').attr('disabled','disabled');
  $('#quote_rate').attr('disabled','disabled');
}
function onCancel()
{
  $("#actions").html("<%= escape_javascript(render :partial => 'form_index' ) %>");
  disabledElements();
}
function onReset()
{
  enabledElements();
  $('#save_quote').attr('disabled','disabled');
  setDefault();
}
function setDefault()
{
  $('#hide_quote_day').val('');
  $('#hide_quote_rate').val('');
  $('#hide_quote_money').val('');
  $('#quote_res_btn').val('click to choose');
  $('#quote_datepicker').val('');
  $('#quote_rate').val('');
}
</script>

<div id="quotes_div">
  <table id="quotes_list"></table>
  <div id="quotes_pager"></div>

  <% content_for :head do %>
    <%= raw(quotes_jqgrid) %>
  <% end %>

  <table>
    <tr id="actions" align="right">
      <%= render 'form_index' %>
    </tr>
    <tr>
      <td style="width: 724px">
        resource:
        <input type="button" id="quote_res_btn" value="click to choose"
               disabled="true" onclick="chooseMoney();"/>
      </td>
    </tr>
    <tr>
      <td>
        <input type="text" id="quote_datepicker" size="20" disabled="true"
               onchange="$('#save_quote').removeAttr('disabled');"/>
        rate:
        <input type="text" id="quote_rate" disabled="true"
               onkeypress="$('#save_quote').removeAttr('disabled');"/>
      </td>
    </tr>
  </table>
</div>
<div id="frame_quote_div" style="display: none">
  <table>
    <tr align="right">
      <td>
        <input type="button" id="discard" value="discard" onclick="discardChoose();"/>
        <input type="button" id="submit" value="submit" onclick=""/>
      </td>
    </tr>
    <tr>
      <td id="title_frame">
      </td>
    </tr>
    <tr>
      <td>
        <iframe id="frame" src="" width=830 height=500 scrolling=no
                noresize border=0 frameborder=no>
        </iframe>
      </td>
    </tr>
  </table>
</div>
