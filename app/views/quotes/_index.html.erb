<script type="text/javascript">
  var canSelectQuote = true;
  $(function() {
    $("#quote_datepicker").datepicker($.datepicker.regional['<%= I18n.locale.to_s %>']);
  });
  function quoteChooseMoney()
  {
    crossPage = "quote";
    crossPageLink = "quotes/new";
    $("#quotes_div").css("display","none");
    $("#quote_p_s_controls").css("display","block");
    ajaxRequest("resources");

    $("#quote_submit").click(function() {
      var selRow = $("#resources_list").getGridParam("selrow");
      if (selRow != null)
      {
        $("#quote_res_btn").val($("#resources_list").getCell(selRow, "tag"));
        $("#hide_quote_money").val($("#resources_list").getCell(selRow, "id"));
        showQuotePage();
      }
    });
  }
  function showQuotePage()
  {
    $("#quotes_div").css("display","block");
    $("#quote_p_s_controls").css("display","none");
    $("#quote_page_selection").html("");
    $("#quote_submit").unbind("click");
    crossPage = "";
  }
  function showQuoteActionForm()
  {
    $("#quote_res_btn").removeAttr("disabled");
    $("#quote_datepicker").removeAttr("disabled");
    $("#quote_rate").removeAttr("disabled");
    setQuoteDefault();
    canSelectQuote = false;
    $("#quotes_list").resetSelection();
  }
  function showQuoteIndexForm(id) {
    if(id != null) {
      editRowId = id;
    }
    location.hash = "#quotes";
  }
  function beforeQuoteSave()
  {
    $("#save_quote").attr("disabled", "disabled");
    var d = new Date($("#quote_datepicker").val());
    $("#hide_quote_day").val(d.toUTCString());
    $("#hide_quote_rate").val($("#quote_rate").val());
    saveQuoteElements();
  }
  function onCancelQuote()
  {
    showQuoteIndexForm();
  }
  function onResetQuote()
  {
    $("#save_quote").attr("disabled","disabled");
    setQuoteDefault();
  }
  function setQuoteDefault()
  {
    $("#hide_quote_day").val("");
    $("#hide_quote_rate").val("");
    $("#hide_quote_money").val("");
    $("#quote_res_btn").val("<%= t('quote.btn_choose')%>");
    $("#quote_datepicker").val("");
    $("#quote_rate").val("");
  }
  function saveQuoteElements() {
    dataPage = new Object();
    dataPage["date"] = $("#quote_datepicker").val();
    dataPage["rate"] = $("#quote_rate").val();
    dataPage["money_id"] = $("#hide_quote_money").val();
    dataPage["money_tag"] = $("#quote_res_btn").val();
  }
  function loadQuoteElements() {
    if(dataPage != null) {
      $("#quote_datepicker").val(dataPage["date"]);
      $("#quote_rate").val(dataPage["rate"]);
      $("#hide_quote_money").val(dataPage["money_id"]);
      $("#quote_res_btn").val(dataPage["money_tag"]);
      dataPage = null;
    }
  }
</script>

<%= raw(quotes_jqgrid) %>

<div id="quotes_div">
  <table>
    <tr>
      <td colspan="2" id="quote_errors"></td>
    </tr>
    <tr>
      <td colspan="2">
        <table id="quotes_list"></table>
        <div id="quotes_pager"></div>
      </td>
    </tr>
    <tr id="actions" align="right">
      <%= render "quotes/form_index" %>
    </tr>
    <tr>
      <td style="width: 724px">
        <%= t('quote.resource')%>:
        <input type="button" id="quote_res_btn" value="<%= t('quote.btn_choose')%>"
               disabled="true" onclick="quoteChooseMoney();"/>
      </td>
    </tr>
    <tr>
      <td>
        <%= t('quote.date')%>:
        <input type="text" id="quote_datepicker" size="20" disabled="true"
               onchange="$('#save_quote').removeAttr('disabled');"/>
        <%= t('quote.rate')%>:
        <input type="text" id="quote_rate" disabled="true"
               onkeypress="$('#save_quote').removeAttr('disabled');"/>
      </td>
    </tr>
  </table>
</div>

<table id="quote_p_s_controls" style="display: none">
    <tr align="right">
      <td>
        <input type="button" value="<%= t('buttons.btn_discard')%>" onclick="showQuotePage();"/>
        <input type="button" id="quote_submit" value="<%= t('buttons.btn_submit')%>" onclick=""/>
      </td>
    </tr>
    <tr id="quote_page_selection">
    </tr>
</table>

<script type="text/javascript">
  var filter = false;
  $("#quotes_list").filterToolbar({searchOnEnter : false});
  $("#quotes_list")[0].toggleToolbar();
</script>
