<script type="text/javascript">
  var editRowId = -1;
  var editCellId = -1;
  var uin;

  
  $(function() {
    $("#waybill_date").datepicker();
  });

  function sendWaybill() {
    var d = new Date($("#waybill_date").val());
    $("#hide_waybill_date").val(d.toUTCString());
    $("#hide_waybill_vatin").val(escape($("#waybill_vatin").val()));
    $("#new_waybill").attr("action", "/waybills?organization_text="
      + escape($("#waybill_organization").val()));
  }

  function saveEdittedRow() {
    if(editRowId >= 0 && editCellId >= 0) {
      $("#waybills_list").saveCell(editRowId,editCellId);
    }
}
</script>

<%= raw(waybills_jqgrid) %>

<input type="button" value="restore" onclick='alert(editRowId);'/>


<table id="waybill_add_list">
  <tbody>
    <tr align="right">
      <td colspan="2">
        * - required fields
      </td>
    </tr>
    <tr align="left">
      <td>
        Date*:
      </td>
      <td align="right">
        <input type="text" id="waybill_date" value="" size="35"/>
      </td>
    </tr>
    <tr align="left">
      <td>
        Organization*:
      </td>
      <td align="right">
        <input type="text" id="waybill_organization" value="" size="35"/>
      </td>
    </tr>
    <tr align="left">
      <td>
        Vatin:
      </td>
      <td align="right">
        <input type="text" id="waybill_vatin" value="" size="35"/>
      </td>
    </tr>
    <tr align="left">
      <td colspan="2">
        Entry*:
      </td>
    </tr>
    <tr>
      <td colspan="2" onmouseup="saveEdittedRow();">
        <table id=waybills_list></table>
        <div id=waybills_pager></div>
      </td>
    </tr>
    <tr align="right">
      <td colspan="2" style="width: 45px">
        <%= form_for(@waybill, :remote => true) do |f| %>
        <%= f.submit "save", :id => "save_waybill", :onclick => "sendWaybill();" %>
        <%= f.hidden_field :date, :id => "hide_waybill_date" %>
        <%= f.hidden_field :owner_id, :id => "hide_waybill_owner",
                           :value => if(current_user != nil &&
                                        current_user.entity != nil) then
                                       current_user.entity.id
                                     end %>
        <%= f.hidden_field :vatin, :id => "hide_waybill_vatin" %>
        <% end %>
      </td>
    </tr>
  </tbody>
</table>
