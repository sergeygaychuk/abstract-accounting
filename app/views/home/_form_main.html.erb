<script type="text/javascript">
  var dataPage = null;
  var crossPage = "";
  var crossPageLink = "";
  var cancelRequest = false;
  var editRowId = null;

  $(window).bind("hashchange", function() {
    if(!cancelRequest) {
      ajaxRequest(location.hash.substr(1, location.hash.length));
    } else {
      cancelRequest = false;
    }
  });

  $(".page_link").live("click", function() {
    crossPage = "";
    crossPageLink = "";
    dataPage = null;
    if($(this).attr("href") == location.hash) {
      ajaxRequest(location.hash.substr(1, location.hash.length));
    }
  });

  $(document).ready(function () {
    if(location.hash.length > 0) {
      ajaxRequest(location.hash.substr(1, location.hash.length));
    }
  });

  $(".button_to").live("submit", function() {
    cancelRequest = true;
    location.hash = $(this).attr("action").substr(1, $(this).attr("action").length);
  });

  function fixPager(param, grid) {
    if(param == "records") {
      var rowNum = $("#" + grid).getGridParam("rowNum");
      $("#" + grid + "_toppager").find(".ui-pg-selbox").children("[value=" + rowNum + "]")
                                 .attr("selected", "true");
    }
  }
</script>

<div id="menu">
	<ul id="nav">
		<% if user_signed_in? %>
			<li><pre><%=t 'menu.account'%></pre>
				<ul>
					<li>
							<%= link_to(t('menu.logout'), destroy_user_session_path) %>
					</li>
				</ul>
			</li>
		<% end %>
		<% if !current_user.nil? and
				(can?(:read, Entity) or can?(:read, [Asset, Money]) or
				can?(:read, Chart) or can?(:read, Quote) or can?(:read, Place)) %>
			<li><pre><%=t 'menu.manage'%></pre>
				<ul>
					<% if can? :read, Place %>
						<li class="t1">
							<a href="#places" class="page_link"><%=t 'menu.place'%></a>
						</li>
					<% end %>
					<% if can? :read, Entity %>
						<li>
							<a href="#entities" class="page_link"><%=t 'menu.entity'%></a>
						</li>
					<% end %>
					<% if can? :read, Asset, Money %>
						<li>
							<a href="#resources" class="page_link"><%=t 'menu.resource'%></a>
						</li>
					<% end %>
					<% if can? :read, Chart %>
						<li>
							<a href="#charts" class="page_link"><%=t 'menu.chart'%></a>
						</li>
					<% end %>
					<% if can? :read, Quote %>
						<li>
							<a href="#quotes" class="page_link"><%=t 'menu.quote'%></a>
						</li>
					<% end %>
				</ul>
			</li>
		<% end %>
		<% if !current_user.nil? and
				(can?(:read, Deal) or can?(:manage, Fact)) %>
			<li><pre><%=t 'menu.process'%></pre>
				<ul>
					<% if can?(:read, Deal) %>
						<li>
							<a href="#deals" class="page_link"><%=t 'menu.deal'%></a>
						</li>
					<% end %>
					<% if can?(:manage, Fact) %>
						<li>
							<a href="#facts" class="page_link"><%=t 'menu.fact'%></a>
						</li>
					<% end %>
				</ul>
			</li>
		<% end %>
		<% if !current_user.nil? and
				(can?(:manage, GeneralLedger) or can?(:manage, Balance) or
				 can?(:manage, Transcript)) %>
			<li><pre><%=t 'menu.report'%></pre>
				<ul>
					<% if can? :manage, GeneralLedger %>
						<li>
							<a href="#general_ledgers" class="page_link"><%=t 'menu.generalLedger'%></a>
						</li>
					<% end %>
					<% if can? :manage, Balance %>
						<li>
							<a href="#balances" class="page_link"><%=t 'menu.balance'%></a>
						</li>
					<% end %>
					<% if can? :manage, Transcript %>
						<li>
							<a href="#transcripts" class="page_link"><%=t 'menu.transcript'%></a>
						</li>
					<% end %>
				</ul>
			</li>
		<% end %>
		<% if !current_user.nil? and
				(can?(:view, Storehouse) or can?(:view, Waybill) or
				 can?(:list, StorehouseRelease) or can?(:return_list, StorehouseReturn) or
				 can?(:resource_state, Storehouse)) %>
			<li><pre><%=t 'menu.storehouse'%></pre>
				<ul>
					<% if can?(:view, Storehouse) %>
						<li>
							<a href="#storehouses" class="page_link"><%=t 'menu.state'%></a>
						</li>
					<% end %>
					<% if can?(:view, Waybill) %>
						<li>
							<a href="#waybills" class="page_link"><%=t 'menu.waybill'%></a>
						</li>
					<% end %>
					<% if can?(:list, StorehouseRelease) %>
						<li>
							<a href="#storehouses/releases" class="page_link"><%=t 'menu.release'%></a>
						</li>
					<% end %>
					<% if can?(:manage, StorehouseReturn) %>
						<li>
							<a href="#storehouses/return/resource_state" class="page_link"><%=t 'menu.resource_state'%></a>
						</li>
					<% end %>
					<% if can?(:manage, Storehouse)%>
						<li>
							<a href="#storehouses/return" class="page_link"><%=t 'menu.return'%></a>
						</li>
					<% end %>
				</ul>
			</li>
		<% end %>
		<% if !current_user.nil? and can?(:manage, :all) then %>
			<li><pre><%= t('menu.administration')%></pre>
				<ul>
					<li><a href="#users" class="page_link"><%= t('menu.user')%></a></li>
					<li><a href="#roles" class="page_link"><%= t('menu.role')%></a></li>
				</ul>
			</li>
		<% end %>
	</ul>
	<div id='sub-menu'></div>
</div>


<div id="body">
</div>
