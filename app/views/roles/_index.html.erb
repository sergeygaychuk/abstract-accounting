<script type="text/javascript">
  var canSelect = true;
  var name = '';
  var rolePages = '';
  function sendDataRole()
  {
    var count = 0;
    <% if !@project_pages.nil? %>
      count = "<%= @project_pages.count %>";
    <% end %>
    var pages = new Array();
    var j = 0;
    for(var i=0; i<count; i++)
    {
      if($('#page_' + i).attr('checked'))
      {
        pages[j] = $('#page_' + i).val();
        j++;
      }
    }
    $('#hide_pages').val(pages);
    $('#hide_name').val(escape($('#role_name').val()));
    saveRoleElements();
  }
  function viewIndexForm()
  {
    location.hash = "#roles";
    dataPage = null;
  }
  function onCancel()
  {
    viewIndexForm();
  }
  function onReset()
  {
    $('#role_name').val(name);
    $('#save_role').attr('disabled','disabled');
    uncheckPages('enabled');
    for(var i=0; i<rolePages.length; i++)
    {
      $('[name=' + rolePages[i] + ']').attr('checked', 'checked');
    }
  }
  function uncheckPages(enabled)
  {
    var count = 0;
    <% if !@project_pages.nil? %>
      count = "<%= @project_pages.count %>";
    <% end %>
    for(var i=0; i<count; i++)
    {
      $('#page_' + i).removeAttr('checked');
      if(enabled)
      {
        $('#page_' + i).removeAttr('disabled');
      } else {
        $('#page_' + i).attr('disabled', 'disabled');
      }
    }
  }
  function viewActionForm(nameValue, pages)
  {
    canSelect = false;
    name = nameValue;
    rolePages = pages;
    uncheckPages('enabled');
    $('#role_name').removeAttr('disabled');
    $('#role_name').val(name);
    $('#data_list').resetSelection();
    if(dataPage == null) {
      for(var i=0; i<rolePages.length; i++)
      {
        $('[name=' + rolePages[i] + ']').attr('checked', 'checked');
      }
    } else {
      for(var i=0; i<dataPage["currRolePages"].length; i++)
      {
        $('[name=' + dataPage["currRolePages"][i] + ']').attr('checked', 'checked');
      }
    }
    $('#pages').css('display','block');
    loadRoleElements();
  }
  function saveRoleElements() {
    dataPage = new Object();
    dataPage["name"] = name;
    dataPage["rolePages"] = rolePages;
    dataPage["currRolePages"] = $("#hide_pages").val().split(",");
  }
  function loadRoleElements() {
    if(dataPage != null) {
      name = dataPage["name"];
      rolePages = dataPage["rolePages"];
      dataPage = null;
    }
  }
</script>

<%= raw(roles_jqgrid) %>


<table>
  <tr>
    <td id="role_errors" colspan="2"></td>
  </tr>
  <tr>
    <td colspan="2">
      <table id="data_list"></table>
      <div id="data_pager"></div>
    </td>
  </tr>
  <tr id="actions" align="right">
    <%= render 'form_index' %>
  </tr>
  <tr align="left">
    <td colspan="2">
      <%= t('role.name')%>:
      <input id="role_name" type="text" value="" disabled="true" style="width: 750px"
             onkeypress="$('#save_role').removeAttr('disabled');"/>
    </td>
  </tr>
  <tr id="pages" style="display: none">
    <td colspan="2">
      <p><%= t('role.permitted')%>:</p>
      <% if !@project_pages.nil? %>
        <% for i in 0..@project_pages.count-1 %>
          <p>
            <%= check_box_tag "page_" + i.to_s, @project_pages[i], false,
                  :disabled => true, :name => @project_pages[i],
                  :onchange => "$('#save_role').removeAttr('disabled');"%>
            <%=   case @project_pages[i]
                    when "Place"
                      t('menu.place')
                    when "Entity"
                      t('menu.entity')
                    when "Asset"
                      t('resource.asset')
                    when "Money"
                      t('resource.money')
                    when "Deal"
                      t('menu.deal')
                    when "Fact"
                      t('menu.fact')
                    when "Chart"
                      t('menu.chart')
                    when "Quote"
                      t('menu.quote')
                    when "Balance"
                      t('menu.balance')
                    when "GeneralLedger"
                      t('menu.generalLedger')
                    when "Transcript"
                      t('menu.transcript')
                    when "Storehouse"
                      t('menu.storehouse')
                    else
                      @project_pages[i]
                  end %>
          </p>
        <% end %>
      <% end %>
    </td>
  </tr>
</table>

<script type="text/javascript">
  var filter = false;
  $("#data_list").filterToolbar({searchOnEnter : false});
  $("#data_list")[0].toggleToolbar();
</script>
