<script type="text/javascript">
  var canSelectEntity = true;
  var tagEntity = "";
  function sendTagEntity()
  {
    $("#hide_entity_tag").val(escape($("#entity_tag").val()));
    saveEntityElements();
  }
  function showEntityIndexForm()
  {
    if(crossPage.length) {
      canSelectEntity = true;
      $("#entity_actions").html("<%= escape_javascript(render :partial => 'entities/form_index') %>");
      $("#entity_tag").attr("disabled","disabled");
      $("#entity_list").trigger("reloadGrid");
      $("#entity_tag").val("");
      cancelRequest = true;
      location.hash = crossPageLink;
    } else {
      location.hash = "#entities";
    }
    dataPage = null;
  }
  function onCancelEntity()
  {
    showEntityIndexForm();
  }
  function onResetEntity()
  {
    $("#entity_tag").val(tagEntity);
    $("#save_entity").attr("disabled","disabled");
  }
  function showEntityActionForm(tag)
  {
    tagEntity = tag;
    $("#entity_tag").val(tagEntity);
    $("#entity_tag").removeAttr("disabled");
    $("#entity_list").resetSelection();
    canSelectEntity = false;
    loadEntityElements();
  }
  function saveEntityElements() {
    dataPage = new Object();
    dataPage["tag"] = tagEntity;
  }
  function loadEntityElements() {
    if(dataPage != null) {
      tagEntity = dataPage["tag"];
      dataPage = null;
    }
  }
</script>

<%= raw(entities_jqgrid) %>

<table>
  <tr>
    <td colspan="2" id="entity_errors"></td>
  </tr>
  <tr>
    <td colspan="2">
      <table id="entity_list"></table>
      <div id="entity_pager"></div>
    </td>
  </tr>
  <tr id="entity_actions" align="right">
    <%= render 'entities/form_index' %>
  </tr>
  <tr align="left">
    <td colspan="2">
      <%=t 'entity.tag'%>:
      <input id="entity_tag" type="text" value="" size="83" disabled="true"
             onkeypress="$('#save_entity').removeAttr('disabled');"/>
    </td>
  </tr>
</table>

<script type="text/javascript">
  var filter = false;
  $("#entity_list").filterToolbar({searchOnEnter : false});
  $("#entity_list")[0].toggleToolbar();
</script>
